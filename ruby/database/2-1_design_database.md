## 使用主鍵跟外鍵建立資料的關係
* 辨識出資料裡適合作爲主鍵的屬性。
* 並且明白資料之間如何透過外鍵去建立關係。
___

* 什麼是主鍵？
* 什麼是外鍵？
* 使用主鍵與外鍵建立關係
  * 一對一的關係
  * 一對多的關係
  * 多對多的關係
___

### 什麼是主鍵？ `Primary Key`  
* 主鍵(Primary Key)是能代表該資料表裡 Record 唯一性的 Attibute
* 每個資料表都一定要有一個 primary key 欄位(Field)

### 定義主鍵的方法
* 辨識出具有`唯一性`以及`持有性`的屬性 attribute
<!-- 投影片沒有持有性，後面的筆記才有，黑人問號 -->

#### 唯一性
* 唯一性表示有個欄位能獨一無二地代表Record，不能讓同樣屬性的欄位有一樣的值
* 例如在一個(人)的屬性裡，姓名，血型，年齡和地址都不具備唯一性，因爲世界上會有同名同姓，同血緣，同年齡或是住在同一個住址的人

#### 持有性
* 如果Record可能不具備某些欄位的資料，該欄位依舊無法作爲主鍵，這就是持有性 (availablity)

舉例：對學校學生而言，下列哪一個是有唯一性的attribute？
- 姓名 X (學生有可能同名)
- 信箱 O
- 駕照號碼 X(學生不一定有駕照)
- 地址 X (學生有可能一起住)
- 學生證號碼 O

* 如果 attribute 裏都沒有適合的 primary key 呢？
* 就新增一個屬性 attribute:id

> 補充：Rails 創 model 指令 會自動產生 id 來當主鍵  
`$ rails g model model_name`
___

### 什麼是外鍵？ Foreign key
* 假設資料表A 有很多個 資料表B
* 資料表A跟資料表B的 primary key 欄位都是 id

* 外鍵就是把 資料表A 的 id 放到對應的 資料表 B 去  
資料表A的id，會被命名爲A_id, 因此能與資料表B本來的id區別
* 如此一來，你就能觀察在資料表B Record的 A_id 欄位了  
能爲每一個資料表B的Record 找到他們所屬的 資料表A
___

### 使用主鍵與外鍵建立關係

#### 一對一
* 一個 User 只有一臺購物車
> 把 users 的 id (`user_id`) 放入 carts table  
> 接著把 carts 的 id (`cart_id`) 放入 users table

___

#### 一對多
* 一個 Category 會有多個 Product
> 把 categories 的 id (`category_id`) 放到 products table

> ### 在一對多的關係裡，要在 "多的那方" 加入 Foreign Key

### Q：爲什麼？因爲如果放在少的那一方欄位會一直增加或是重複？
A：答案是如果把那個 Foreign Key 加入少的那一方會讓那個欄位在少資料那一方的欄位失去唯一性   
舉例：

把 Foreign Key 放在資料少的那一方：

|人_id|人|車_id|
|:-:|:-:|:-:|:-:|:-:|
|1|Bill|2,3|
|2|Siri|1|||

從上表可以觀察到：
* Bill 有車_id 2,3 的車，發現一個cell裡面擠了兩筆資料
* 這樣在讀取或是維護的時候都會很麻煩

因此我們把 Foreign Key 放在資料多的那一方：

|車_id|車|人_id|
|:-:|:-:|:-:|
|1|BMW|2|
|2|AE86|1|
|3|ATHLA|1|

這樣子就沒問題啦！！！

___

#### 多對多
* 可以把多對多看/拆成兩個一對多的關係：  
1. 一個使用者購買很多商品。
2. 一個商品被很多使用者購買。

> 在兩者多對多的 table 之間，新增一個資料表 `join table`

* 新增"交易記錄"在商品與使用者中間。
> 使用者--交易記錄--商品  
user--order--product

> ### 在一對多的關係裡，要在 "多的那方" 加入 Foreign Key

* 一個使用者會有很多交易記錄
> 把使用者 id 加入 交易記錄

* 一個商品會列入多筆交易記錄
> 把商品 id 加入 交易記錄

<!-- 時間累計 3hr45mins，本節耗時 1hr20mins -->
